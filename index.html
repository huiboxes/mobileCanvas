<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>手机画板</title>
    <link rel="stylesheet" href="./main.css" />
  </head>
  <body>
    <canvas id="canvas" width="300" height="300"></canvas>
    <div class="actions" id="actions">
      <button id="eraser">橡皮擦</button>
      <button id="brush">画笔</button>
    </div>
    <script>
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");

      autoSetCanvasArea(canvas);

      listenToMouse();

      /********/

      var eraserEnabled = false;

      eraser.onclick = function() {
        eraserEnabled = true;
        actions.className = "actions x";
      };

      brush.onclick = function() {
        eraserEnabled = false;
        actions.className = "actions";
      };

      function autoSetCanvasArea(canvas) {
        setCanvasArea();

        window.onresize = function() {
          setCanvasArea();
        };

        function setCanvasArea() {
          var pageWidth = document.documentElement.clientWidth;
          var pageHeight = document.documentElement.clientHeight;

          canvas.width = pageWidth;
          canvas.height = pageHeight;
        }
      }

      function listenToMouse() {
        var using = false;
        var lastPoint = {
          x: undefined,
          y: undefined
        };
        canvas.onmousedown = function(a) {
          var x = a.clientX;
          var y = a.clientY;
          using = true;
          if (eraserEnabled) {
            context.clearRect(x - 5, y - 5, 10, 10);
          } else {
            lastPoint = {
              x: x,
              y: y
            };
            drawCircle(x, y, 2.5);
          }
        };

        canvas.onmousemove = function(a) {
          var x = a.clientX;
          var y = a.clientY;

          if (!using) {
            return;
          }

          if (eraserEnabled) {
            context.clearRect(x - 5, y - 5, 10, 10);
          } else {
            newPoint = {
              x: x,
              y: y
            };
            drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y);
            lastPoint = newPoint;
          }
        };

        canvas.onmouseup = function() {
          using = false;
        };
      }

      function drawLine(x1, y1, x2, y2) {
        context.beginPath();
        context.lineWidth = 5;
        context.moveTo(x1, y1);
        context.lineTo(x2, y2);
        context.stroke();
        context.closePath();
      }

      function drawCircle(x, y, radius) {
        context.beginPath();
        context.arc(x, y, radius, 0, 6);
        context.fill();
      }
    </script>
  </body>
</html>
